<% @average_rating = product.reviews.count > 0 ? product.reviews.sum(:rating).to_f / product.reviews.count : 0  %>

<% reviews_count  = product.reviews.count %>
<% rating_with_five   = reviews_count != 0  ? product.reviews.rating_with_five * 100 / reviews_count : 0 %>
<% rating_with_four   = reviews_count != 0  ? product.reviews.rating_with_four * 100 / reviews_count : 0 %>
<% rating_with_three  = reviews_count != 0  ? product.reviews.rating_with_three * 100 / reviews_count : 0 %>
<% rating_with_two    = reviews_count != 0  ? product.reviews.rating_with_two * 100 / reviews_count  : 0%>
<% rating_with_one    = reviews_count != 0  ? product.reviews.rating_with_one * 100 / reviews_count : 0 %>

<div class="ratings">
  <p class="product-review-description">
    Let us know your thoughts on a product or view reviews from our members,
    independent experts and other websites.
  </p>
  <div class="d-flex">
    <p class="ratings-stars product-review-rating-stars">
      <% if product.reviews.count > 0 %>
        <%= @average_rating.try(:round) %>
      <% else %>
        0
      <% end %>
      <span title="<%= txt_stars(@average_rating) %>">
        <%= render 'spree/reviews/stars', stars: @average_rating.try(:round) %>
      </span>
    </p>
  </div>
  <p class="ratings-basedupon product-review-basedupon"><%= Spree.t(:based_upon_review_count, count: reviews_count) %></p>

  <div class="product-review-bars">
    <div class="product-review-bar">
      <p class="mb-0 mr-3">5</p>  
      <div class="progress product-review-progress-bar">
        <div class="progress-bar bg-warning" role="progressbar" style="width: <%= rating_with_five %>%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p class="mb-0"><%= rating_with_five %>%</p>
    </div>
    <div class="product-review-bar">
      <p class="mb-0 mr-3">4</p>  
      <div class="progress product-review-progress-bar">
        <div class="progress-bar bg-warning" role="progressbar" style="width: <%= rating_with_four %>%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p class="mb-0"><%= rating_with_four %>%</p>
    </div>
    <div class="product-review-bar">
      <p class="mb-0 mr-3">3</p>  
      <div class="progress product-review-progress-bar">
        <div class="progress-bar bg-warning" role="progressbar" style="width: <%= rating_with_three %>%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p class="mb-0"><%= rating_with_three %>%</p>
    </div>
    <div class="product-review-bar">
      <p class="mb-0 mr-3">2</p>  
      <div class="progress product-review-progress-bar">
        <div class="progress-bar bg-warning" role="progressbar" style="width: <%= rating_with_two  %>%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p class="mb-0"><%= rating_with_two %>%</p>
    </div>
    <div class="product-review-bar">
      <p class="mb-0 mr-3">1</p>  
      <div class="progress product-review-progress-bar">
        <div class="progress-bar bg-warning" role="progressbar" style="width: <%= rating_with_one %>%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p class="mb-0"><%= rating_with_one %>%</p>
    </div>
  </div>


  <div itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating">
    <span itemprop="ratingValue" content="<%= @average_rating %>"></span>
    <span itemprop="reviewCount" content="<%= reviews_count %>"></span>
  </div>
</div> 